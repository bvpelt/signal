<app-catagory></app-catagory>

<div class="header-section">
  <h2>Number of products: {{ dataStore.cardCount() }}</h2>
  <button class="btn-add-new" (click)="startAddNew()">
    ➕ Add New Product
  </button>
</div>

@if (dataStore.loadingCards()) {
  <div class="loading">
    <p>Loading...</p>
  </div>
}

<!-- Add New Card Form -->
@if (isAddingNew()) {
  <div class="card card-new">
    <app-edit-card
      [categories]="dataStore.categories()"
      [isNewCard]="true"
      (save)="onSaveCard($event)"
      (cancel)="cancelEdit()"
    />
  </div>
}

<!-- Existing Cards List -->
<div class="cards">
  @for (card of dataStore.sortedCards(); track card.id) {
    <div class="card" [class.ordered]="getOrderedQuantity(card.id) > 0">
      @if (editingCardId() === card.id) {
        <!-- Edit Mode -->
        <app-edit-card
          [card]="editingCard()"
          [categories]="dataStore.categories()"
          [isNewCard]="false"
          (save)="onSaveCard($event)"
          (cancel)="cancelEdit()"
        />
      } @else {
        <!-- View Mode -->
        <div class="card-header">
          <div class="card-title">{{ card.title }}</div>
          <button class="btn-edit-icon" (click)="startEdit(card)">✏️</button>
        </div>

        <div class="image">
          <img [src]="card.image" width="170" height="180" [alt]="card.title" />
        </div>

        <div class="card-description">{{ card.description }}</div>
        <div class="card-price">Price: ${{ card.price.toFixed(2) }}</div>
        <div class="card-ordered">
          Ordered: {{ getOrderedQuantity(card.id) }}
        </div>

        <div class="buttons">
          <button class="btn-add" (click)="addToShoppingCard(card)">
            Add +
          </button>
          <button class="btn-remove" (click)="removeCardFromOrder(card)">
            Remove -
          </button>
        </div>
      }
    </div>
  }
</div>

@if (dataStore.orders().length > 0) {
  <div class="ordercard">
    <app-ordercard></app-ordercard>
  </div>
}
